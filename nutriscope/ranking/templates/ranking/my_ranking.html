{% extends 'ranking/base.html' %}

{% block content %}
<body>
    <div class="parent">
        <div class="left-content">
            <div class="card">
                <div class="card-header">
                    ğŸ† ì¢… í•© ìˆœ ìœ„ğŸ† 
                </div>
                
                <div class="card-body">
                    {% if page_obj %}
                        {% for i in page_obj %}
                            <div class="ranking-item" 
                                data-representative-name="{{ i.representative_name }}"
                                onclick="loadProductDetails(this)">
                                <div class="rank-number">
                                    {{ i.rank }}
                                </div>
                                <div class="rank-text">
                                    {{ i.category }} | {{ i.representative_name }}
                                </div>
                            </div>
                        {% endfor %}

                        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                        {% if page_obj.has_other_pages %}
                            <div class="pagination">
                                {% if page_obj.has_previous %}
                                    <a href="?page=1">&laquo; ì²˜ìŒ</a>
                                    <a href="?page={{ page_obj.previous_page_number }}">ì´ì „</a>
                                {% endif %}
                                
                                {% for num in page_obj.paginator.page_range %}
                                    {% if page_obj.number == num %}
                                        <span class="current">{{ num }}</span>
                                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                        <a href="?page={{ num }}">{{ num }}</a>
                                    {% endif %}
                                {% endfor %}
                                
                                {% if page_obj.has_next %}
                                    <a href="?page={{ page_obj.next_page_number }}">ë‹¤ìŒ</a>
                                    <a href="?page={{ page_obj.paginator.num_pages }}">ë§ˆì§€ë§‰ &raquo;</a>
                                {% endif %}
                            </div>
                        {% endif %}

                    {% else %}
                        <div style="text-align: center; padding: 2rem; color: #666;">
                            <p>ìˆœìœ„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    {% endif %}    
                </div>
            </div>
        </div>
        
        <div class="right-content" id="rightContent">
            <div class="placeholder-message">
                ğŸ’¡ ë¹„êµí•˜ê³  ì‹¶ì€ ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”.
            </div>
        </div>
    </div>
    
    <script>
        // ì œí’ˆ ìƒì„¸ ì •ë³´ ë¡œë“œ í•¨ìˆ˜
        function loadProductDetails(element) {
            // ëª¨ë“  ranking-itemì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.ranking-item').forEach(item => {
                item.classList.remove('active');
            });

            // í´ë¦­í•œ í•­ëª©ì— active í´ë˜ìŠ¤ ì¶”ê°€
            element.classList.add('active');
            const representativeName = element.getAttribute('data-representative-name');
            const rightContent = document.getElementById('rightContent');

            // ë¡œë”© í‘œì‹œ
            rightContent.innerHTML = '<div class="loading">ì œí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

            // AJAX ìš”ì²­
            fetch(`/ranking/api/product-details/?representative_name=${encodeURIComponent(representativeName)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        rightContent.innerHTML = `<div class="placeholder-message">âŒ ${data.error}</div>`;
                        return;
                    }
                    
                    // dataê°€ ì œëŒ€ë¡œ ë“¤ì–´ì˜¤ë©´, ì œí’ˆ ìƒì„¸ ì •ë³´ í‘œì‹œ í•¨ìˆ˜ ì‹¤í–‰
                    displayProductDetails(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                    rightContent.innerHTML = '<div class="placeholder-message">âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
                });
        }
        
        // ì œí’ˆ ìƒì„¸ ì •ë³´ í‘œì‹œ í•¨ìˆ˜
        function displayProductDetails(data) {
            const rightContent = document.getElementById('rightContent');
            let html = `
                <div class="product-detail-header">
                    <h3>ğŸ“¦ ${data.representative_name}</h3>
                    <p style="color: #666; margin-top: 5px;">ì´ ${data.products.length}ê°œì˜ ì œí’ˆ</p>
                </div>
            `;

            data.products.forEach(product => {
                // í• ì¸ìœ¨ ê³„ì‚°
                let discountHtml = '';
                if (product.original_price && product.original_price > product.sale_price) {
                    const discountRate = Math.round((1 - product.sale_price / product.original_price) * 100);
                    discountHtml = `<span class="discount-rate">${discountRate}%</span>`;
                }
            
                html += `
                    <div class="product-card">
                        <div class="product-header">
                            ${product.image_url 
                                ? `<img src="${product.image_url}" alt="${product.product_name}" class="product-image">`
                                : `<div class="product-image-placeholder">ì´ë¯¸ì§€<br>ì—†ìŒ</div>`
                            }
                            <div class="product-info">
                                <div class="badge-container">
                                    <span class="shop-badge">${product.shop_name}</span>
                                    <span class="brand-name">${product.brand_name || 'ë¸Œëœë“œ ì •ë³´ ì—†ìŒ'}</span>
                                </div>
                                <div class="product-name">${product.product_name}</div>
                                <div class="display-name">${product.display_name}</div>
                            </div>
                            <div class="product-price">
                                ${product.original_price 
                                    ? `<span class="original-price">${product.original_price.toLocaleString()}ì›</span>`
                                    : ''
                                }
                                <span class="sale-price">${product.sale_price.toLocaleString()}ì›</span>
                                ${discountHtml}
                            </div>
                        </div> 
                    </div>
                `;
            });
            
            rightContent.innerHTML = html;

        }
    </script>
</body>
{% comment %} <div class="brand-name">${product.brand_name || 'ë¸Œëœë“œ ì •ë³´ ì—†ìŒ'}</div> {% endcomment %}
{% comment %} <div class="quantity">${product.quantity || 'ìš©ëŸ‰ ì •ë³´ ì—†ìŒ'}</div> {% endcomment %}
{% endblock %}